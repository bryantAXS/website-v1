/*!
 * Craft by Pixel & Tonic
 *
 * @package   Craft
 * @author    Pixel & Tonic, Inc.
 * @copyright Copyright (c) 2013, Pixel & Tonic, Inc.
 * @license   http://buildwithcraft.com/license Craft License Agreement
 * @link      http://buildwithcraft.com
 */
(function(a){Craft.GetHelpWidget=Garnish.Base.extend({$widget:null,$message:null,$fromEmail:null,$attachDebugFiles:null,$sendBtn:null,$spinner:null,$error:null,originalBodyVal:null,originalFromVal:null,originalAttachDebugFilesVal:null,loading:false,$errorList:null,init:function(b){this.$widget=a("#widget"+b);this.$message=this.$widget.find(".message:first");this.$fromEmail=this.$widget.find(".fromEmail:first");this.$attachDebugFiles=this.$widget.find(".attachDebugFiles:nth-child(2)");this.$sendBtn=this.$widget.find(".submit:first");this.$spinner=this.$widget.find(".spinner:first");this.$error=this.$widget.find(".error:first");this.$form=this.$widget.find("form:first");this.originalBodyVal=this.$message.val();this.originalFromVal=this.$fromEmail.val();this.originalAttachDebugFilesVal=this.$attachDebugFiles.val();this.addListener(this.$sendBtn,"activate","sendMessage")},sendMessage:function(){if(this.loading){return}this.loading=true;this.$sendBtn.addClass("active");this.$spinner.removeClass("hidden");var b={message:this.$message.val(),fromEmail:this.$fromEmail.val(),attachDebugFiles:this.$attachDebugFiles.val()};Craft.postActionRequest("dashboard/sendSupportRequest",b,a.proxy(function(c){this.loading=false;this.$sendBtn.removeClass("active");this.$spinner.addClass("hidden");if(this.$errorList){this.$errorList.children().remove()}if(c.success){this.$message.val(this.originalBodyVal);this.$fromEmail.val(this.originalFromVal);this.$attachDebugFiles.val(this.originalAttachDebugFilesVal);Craft.cp.displayNotice(Craft.t("Message sent successfully."))}else{Craft.cp.displayError(Craft.t("Couldnâ€™t send support request."));if(c.errors){if(!this.$errorList){this.$errorList=a('<ul class="errors"/>').insertAfter(this.$form)}for(var f in c.errors){for(var e=0;e<c.errors[f].length;e++){var d=c.errors[f][e];a("<li>"+d+"</li>").appendTo(this.$errorList)}}}}},this))}})})(jQuery);